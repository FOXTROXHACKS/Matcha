setrobloxinput(true)
local Settings = {
    AutoGen = {
        Activate = true,
        Toggle = false,
        Keybind = "x",
    },
    LastToggle = 0,
    Cooldown = 0 ,
}
local Modules = {
    "https://raw.githubusercontent.com/thelucas128/Macha/refs/heads/main/Json.lua",
    "https://raw.githubusercontent.com/thelucas128/Macha/refs/heads/main/Repr_Fork.lua",
    "https://raw.githubusercontent.com/thelucas128/Macha/main/Library.lua",
    "https://raw.githubusercontent.com/thelucas128/Macha/refs/heads/main/Keybind.lua",
}
if not _G.LibLoaded then
    for i,v in pairs(Modules) do
        print(i,v)
        loadstring(game:HttpGet(v),true)()
        wait(0.1)
    end 
    task.wait(1)
    _G.LibLoaded = true
end

-- Drawing Setup
local RotationText = Drawing.new("Text")
RotationText.Text = "Rotation: N/A"

RotationText.Color = Color3.fromRGB(255, 255, 255)
RotationText.Position = Vector2.new(10, 10)
RotationText.Visible = true

local GoalText = Drawing.new("Text")
GoalText.Text = "Goal: N/A"

GoalText.Color = Color3.fromRGB(255, 255, 0)
GoalText.Position = Vector2.new(10, 35)
GoalText.Visible = true


local StatusText = Drawing.new("Text")
StatusText.Text = "Status: Waiting"

StatusText.Color = Color3.fromRGB(100, 255, 100)
StatusText.Position = Vector2.new(10, 60)
StatusText.Visible = true


local DifferenceText = Drawing.new("Text")
DifferenceText.Text = "Difference: N/A"

DifferenceText.Color = Color3.fromRGB(255, 150, 0)
DifferenceText.Position = Vector2.new(10, 85)
DifferenceText.Visible = true

local Players : Players = game:GetService("Players")
local Player : LocalPlayer = Players.LocalPlayer
local PlayerGui : Instance = Player:FindFirstChild("PlayerGui")

local function normalizeAngle(angle)
    angle = angle % 360
    return angle < 0 and angle + 360 or angle
end

local function getAngleDifference(angle1, angle2)
    local diff = math.abs((angle1 - angle2) % 360)
    return diff > 180 and 360 - diff or diff
end

local function isRotationClose(rotation1, rotation2, threshold)
    return getAngleDifference(rotation1, rotation2) <= (threshold or 5)
end

Init_AutoGen = function()
    local CheckPrompt : Instance = PlayerGui:FindFirstChild("SkillCheckPromptGui")
    if CheckPrompt then
        local Rotation = MemoryManager.GetGuiObjectRotation(CheckPrompt.Check.Line.Address)
        local GoalRotation = MemoryManager.GetGuiObjectRotation(CheckPrompt.Check.Goal.Address)
        
        Rotation = normalizeAngle(Rotation)
        GoalRotation = normalizeAngle(GoalRotation)
        

        RotationText.Text = string.format("Rotation: %.2f°", Rotation)
        GoalText.Text = string.format("Goal: %.2f°", GoalRotation)
        
        local lowerSuccess = normalizeAngle(104 + GoalRotation)
        local upperSuccess = normalizeAngle(114 + GoalRotation)
        local upperNeutral = normalizeAngle(159 + GoalRotation)
        
        local diff = getAngleDifference(Rotation, GoalRotation)
        DifferenceText.Text = string.format("Difference: %.2f°", diff)
        
        if lowerSuccess <= Rotation and Rotation <= upperSuccess then
			keypress(32)
			keyrelease(32)
            print("Success!", Rotation, GoalRotation)
            StatusText.Text = "Status: SUCCESS!"
            StatusText.Color = Color3.fromRGB(0, 255, 0)
            
        elseif upperSuccess < Rotation and Rotation <= upperNeutral then
			keypress(32)
			keyrelease(32)
            print("Neutral", Rotation, GoalRotation)
            StatusText.Text = "Status: Neutral"
            StatusText.Color = Color3.fromRGB(255, 255, 0)

        else
            StatusText.Text = "Status: Waiting..."
            StatusText.Color = Color3.fromRGB(100, 255, 100)
        end
    else
      
        RotationText.Text = "Rotation: N/A"
        GoalText.Text = "Goal: N/A"
        StatusText.Text = "Status: No Prompt"
        StatusText.Color = Color3.fromRGB(150, 150, 150)
        DifferenceText.Text = "Difference: N/A"
    end
end

while true do
    -- if not isrbxactive() then continue end
    if Settings.AutoGen.Toggle and iskeypressed(Keybind[string.lower(Settings.AutoGen.Keybind)]) and (os.clock() - Settings.LastToggle) >= Settings.Cooldown then
        Settings.AutoGen.Activate = not Settings.AutoGen.Activate
        Settings.LastToggle = os.clock()
    end
    if Settings.AutoGen.Activate then
        Init_AutoGen()
    end
    task.wait()
end